/*

|       __ _____                     ________                              __
|      / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /
|  __ / // // // // // _  // _// // / / // _  // _//     // //  \/ // _ \/ /
| /  / // // // // // ___// / / // / / // ___// / / / / // // /\  // // / /__
| \___//____ \\___//____//_/ _\_  / /_//____//_/ /_/ /_//_//_/ /_/ \__\_\___/
|           \/              /____/                              version 0.7.12
 http://terminal.jcubic.pl

 Licensed under GNU LGPL Version 3 license
 Copyright (c) 2011-2013 Jakub Jankiewicz <http://jcubic.pl>

 Includes:

 Storage plugin Distributed under the MIT License
 Copyright (c) 2010 Dave Schindler

 jQuery Timers licenced with the WTFPL
 <http://jquery.offput.ca/every/>

 Cross-Browser Split 1.1.1
 Copyright 2007-2012 Steven Levithan <stevenlevithan.com>
 Available under the MIT License

 Date: Sat, 21 Dec 2013 16:57:21 +0000
*/
(function(a,A){function ha(e,a){var f;if("string"===typeof e&&"string"===typeof a)return localStorage[e]=a,!0;if("object"===typeof e&&"undefined"===typeof a){for(f in e)e.hasOwnProperty(f)&&(localStorage[f]=e[f]);return!0}return!1}function V(e,a){var f,d;f=new Date;f.setTime(f.getTime()+31536E6);f="; expires="+f.toGMTString();if("string"===typeof e&&"string"===typeof a)return document.cookie=e+"="+a+f+"; path=/",!0;if("object"===typeof e&&"undefined"===typeof a){for(d in e)e.hasOwnProperty(d)&&(document.cookie=
d+"="+e[d]+f+"; path=/");return!0}return!1}function ia(e){return localStorage[e]}function ja(e){var a,f,d;e+="=";a=document.cookie.split(";");for(f=0;f<a.length;f++){for(d=a[f];" "===d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(e))return d.substring(e.length,d.length)}return null}function ka(a){return delete localStorage[a]}function la(a){return V(a,"",-1)}function P(a,b){var f=[],d=a.length;if(d<b)return[a];for(var h=0;h<d;h+=b)f.push(a.substring(h,h+b));return f}function ma(e){var b=
e?[e]:[];a.extend(this,{size:function(){return b.length},pop:function(){if(0===b.length)return null;var a=b[b.length-1];b=b.slice(0,b.length-1);return a},push:function(a){b=b.concat([a]);return a},top:function(){return 0<b.length?b[b.length-1]:null}})}function na(e,b){var f=!0;"string"===typeof e&&""!==e&&(e+="_");var d=a.Storage.get(e+"commands"),d=d?(new Function("return "+d+";"))():[],h=d.length-1;a.extend(this,{append:function(s){f&&d[d.length-1]!==s&&(d.push(s),b&&d.length>b&&(d=d.slice(-b)),
h=d.length-1,a.Storage.set(e+"commands",a.json_stringify(d)))},data:function(){return d},reset:function(){h=d.length-1},last:function(){return d[length-1]},end:function(){return h===d.length-1},position:function(){return h},current:function(){return d[h]},next:function(){h<d.length-1&&++h;if(-1!==h)return d[h]},previous:function(){var a=h;0<h&&--h;if(-1!==a)return d[h]},clear:function(){d=[];this.purge()},enabled:function(){return f},enable:function(){f=!0},purge:function(){a.Storage.remove(e+"commands")},
disable:function(){f=!1}})}function $(e,b){var f=e.split(/(\s+)/);return{name:f[0],args:b(f.slice(2).join("")),rest:e.replace(new RegExp("^"+a.terminal.escape_regex(f[0])+" "),"")}}function ba(e){var b=a('<div class="terminal"><span>&nbsp;</span></div>').appendTo("body"),f=b.find("span").width();b.remove();b=Math.floor(e.width()/f);Y(e)&&(e=e.innerWidth()-e.width(),b-=Math.ceil((20-e/2)/(f-1)));return b}function Y(a){return a.get(0).scrollHeight>a.innerHeight()}a.omap=function(e,b){var f={};a.each(e,
function(a,h){f[a]=b.call(e,a,h)});return f};var O="undefined"!==typeof window.localStorage;a.extend({Storage:{set:O?ha:V,get:O?ia:ja,remove:O?ka:la}});jQuery.fn.extend({everyTime:function(a,b,f,d,h){return this.each(function(){jQuery.timer.add(this,a,b,f,d,h)})},oneTime:function(a,b,f){return this.each(function(){jQuery.timer.add(this,a,b,f,1)})},stopTime:function(a,b){return this.each(function(){jQuery.timer.remove(this,a,b)})}});jQuery.extend({timer:{guid:1,global:{},regex:/^([0-9]+)\s*(.*s)?$/,
powers:{ms:1,cs:10,ds:100,s:1E3,das:1E4,hs:1E5,ks:1E6},timeParse:function(a){if(a===A||null===a)return null;var b=this.regex.exec(jQuery.trim(a.toString()));return b[2]?parseInt(b[1],10)*(this.powers[b[2]]||1):a},add:function(a,b,f,d,h,s){var t=0;jQuery.isFunction(f)&&(h||(h=d),d=f,f=b);b=jQuery.timer.timeParse(b);if(!("number"!==typeof b||isNaN(b)||0>=b)){h&&h.constructor!==Number&&(s=!!h,h=0);h=h||0;s=s||!1;a.$timers||(a.$timers={});a.$timers[f]||(a.$timers[f]={});d.$timerID=d.$timerID||this.guid++;
var g=function(){s&&g.inProgress||(g.inProgress=!0,(++t>h&&0!==h||!1===d.call(a,t))&&jQuery.timer.remove(a,f,d),g.inProgress=!1)};g.$timerID=d.$timerID;a.$timers[f][d.$timerID]||(a.$timers[f][d.$timerID]=window.setInterval(g,b));this.global[f]||(this.global[f]=[]);this.global[f].push(a)}},remove:function(a,b,f){var d=a.$timers,h;if(d){if(!b)for(var s in d)d.hasOwnProperty(s)&&this.remove(a,s,f);else if(d[b]){if(f)f.$timerID&&(window.clearInterval(d[b][f.$timerID]),delete d[b][f.$timerID]);else for(var t in d[b])d[b].hasOwnProperty(t)&&
(window.clearInterval(d[b][t]),delete d[b][t]);for(h in d[b])if(d[b].hasOwnProperty(h))break;h||(h=null,delete d[b])}for(h in d)if(d.hasOwnProperty(h))break;h||(a.$timers=null)}}}});if(jQuery.browser&&jQuery.browser.msie||/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase()))jQuery(window).one("unload",function(){var a=jQuery.timer.global,b;for(b in a)if(a.hasOwnProperty(b))for(var f=a[b],d=f.length;--d;)jQuery.timer.remove(f[d],b)});(function(a){if(String.prototype.split.toString().match(/\[native/)){var b=
String.prototype.split,f=/()??/.exec("")[1]===a,d;d=function(d,s,t){if("[object RegExp]"!==Object.prototype.toString.call(s))return b.call(d,s,t);var g=[],r=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.extended?"x":"")+(s.sticky?"y":""),x=0,w,u,q;s=new RegExp(s.source,r+"g");d+="";f||(w=new RegExp("^"+s.source+"$(?!\\s)",r));for(t=t===a?4294967295:t>>>0;u=s.exec(d);){r=u.index+u[0].length;if(r>x&&(g.push(d.slice(x,u.index)),!f&&1<u.length&&u[0].replace(w,function(){for(var b=1;b<arguments.length-
2;b++)arguments[b]===a&&(u[b]=a)}),1<u.length&&u.index<d.length&&Array.prototype.push.apply(g,u.slice(1)),q=u[0].length,x=r,g.length>=t))break;s.lastIndex===u.index&&s.lastIndex++}x===d.length?!q&&s.test("")||g.push(""):g.push(d.slice(x));return g.length>t?g.slice(0,t):g};String.prototype.split=function(a,b){return d(this,a,b)};return d}})();a.json_stringify=function(e,b){var f="",d;b=b===A?1:b;switch(typeof e){case "function":f+=e;break;case "boolean":f+=e?"true":"false";break;case "object":if(null===
e)f+="null";else if(e instanceof Array){var f=f+"[",h=e.length;for(d=0;d<h-1;++d)f+=a.json_stringify(e[d],b+1);f+=a.json_stringify(e[h-1],b+1)+"]"}else{f+="{";for(h in e)e.hasOwnProperty(h)&&(f+='"'+h+'":'+a.json_stringify(e[h],b+1));f+="}"}break;case "string":var h=e,s={"\\\\":"\\\\",'"':'\\"',"/":"\\/","\\n":"\\n","\\r":"\\r","\\t":"\\t"};for(d in s)s.hasOwnProperty(d)&&(h=h.replace(new RegExp(d,"g"),s[d]));f+='"'+h+'"';break;case "number":f+=String(e)}f+=1<b?",":"";1===b&&(f=f.replace(/,([\]}])/g,
"$1"));return f.replace(/([\[{]),/g,"$1")};a.fn.cmd=function(e){function b(a){I.toggleClass("inverted")}function f(){D="(reverse-i-search)`"+B+"': ";L()}function d(a){var b=c.data(),d,e=b.length;a&&0<z&&(e-=z);if(0<B.length)for(a=B.length;0<a;a--){d=B.substring(0,a).replace(/([.*+{}\[\]?])/g,"\\$1");d=new RegExp(d);for(var h=e;h--;)if(d.test(b[h])){z=b.length-h;p=0;g.set(b[h],!0);v();B.length!==a&&(B=B.substring(0,a),f());return}}B=""}function h(a){var c=a.substring(0,w-u);a=a.substring(w-u);return[c].concat(P(a,
w))}function s(){x.focus();g.oneTime(100,function(){g.insert(x.val());x.blur().val("")})}function t(a){var b;if("function"==typeof e.keydown&&(b=e.keydown(a),b!==A))return b;if(H){38===a.which||80===a.which&&a.ctrlKey||(E=!0);if(!q||35!==a.which&&36!==a.which&&37!==a.which&&38!==a.which&&39!==a.which&&40!==a.which&&13!==a.which&&27!==a.which){if(a.altKey)return 68===a.which?(g.set(m.slice(0,p)+m.slice(p).replace(/[^ ]+ |[^ ]+$/,""),!0),!1):!0;if(13===a.keyCode)c&&m&&(e.historyFilter&&e.historyFilter(m)||
!e.historyFilter)&&c.append(m),a=m,c.reset(),g.set(""),e.commands&&e.commands(a),"function"===typeof D&&L();else if(8===a.which)q?(B=B.slice(0,-1),f()):""!==m&&0<p&&(m=m.slice(0,p-1)+m.slice(p,m.length),--p,v());else if(9!==a.which||a.ctrlKey||a.altKey){if(46===a.which)return""!==m&&p<m.length&&(m=m.slice(0,p)+m.slice(p+1,m.length),v()),!0;if(c&&38===a.which||80===a.which&&a.ctrlKey)E?(R=m,g.set(c.current())):g.set(c.previous()),E=!1;else if(c&&40===a.which||78===a.which&&a.ctrlKey)g.set(c.end()?
R:c.next());else if(37===a.which||66===a.which&&a.ctrlKey)if(a.ctrlKey&&66!==a.which){b=p-1;a=0;for(" "===m[b]&&--b;0<b;--b)if(" "===m[b]&&" "!==m[b+1]){a=b+1;break}else if("\n"===m[b]&&"\n"!==m[b+1]){a=b;break}g.position(a)}else 0<p&&(--p,v());else if(82===a.which&&a.ctrlKey)q?d(!0):(y=D,f(),R=m,m="",v(),q=!0);else if(71==a.which&&a.ctrlKey)q&&(D=y,L(),m=R,v(),q=!1,B="");else if(39===a.which||70===a.which&&a.ctrlKey)a.ctrlKey&&70!==a.which?(" "===m[p]&&++p,a=m.slice(p).match(/\S[\n\s]{2,}|[\n\s]+\S?/),
!a||a[0].match(/^\s+$/)?p=m.length:" "!==a[0][0]?p+=a.index+1:(p+=a.index+a[0].length-1," "!==a[0][a[0].length-1]&&--p),v()):p<m.length&&(++p,v());else{if(123===a.which)return!0;if(36===a.which)g.position(0);else if(35===a.which)g.position(m.length);else{if(a.shiftKey&&45==a.which)return s(),!0;if(a.ctrlKey||a.metaKey){if(192===a.which||a.metaKey&&(82===a.which||76===a.which))return!0;if(a.shiftKey){if(84===a.which)return!0}else if(87===a.which){if(""!==m){a=m.slice(0,p);b=m.slice(p+1);var h=a.match(/([^ ]+ *$)/);
p=a.length-h[0].length;m=a.slice(0,p)+b;v()}}else if(72===a.which)""!==m&&0<p&&(m=m.slice(0,--p),p<m.length-1&&(m+=m.slice(p)),v());else if(65===a.which)g.position(0);else if(69===a.which)g.position(m.length);else{if(88===a.which||67===a.which||84===a.which)return!0;if(86===a.which)return s(),!0;75===a.which?0===p?g.set(""):p!==m.length&&g.set(m.slice(0,p)):85===a.which&&(g.set(m.slice(p,m.length)),g.position(0))}}else return!0}}}else g.insert("\t")}else D=y,q=!1,z=null,B="",L(),27===a.which&&(m=
""),v(),t.call(this,a);return!1}}var g=this,r=g.data("cmd");if(r)return r;g.addClass("cmd");g.append('<span class="prompt"></span><span></span><span class="cursor">&nbsp;</span><span></span>');var x=a("<textarea/>").addClass("clipboard").appendTo(g);e.width&&g.width(e.width);var w,u,q=!1,B="",z=null,y,S=e.mask||!1,m="",p=0,D,H=e.enabled,J=e.historySize||60,F,c,I=g.find(".cursor"),v=function(c){function b(c,d){if(d===c.length)g.html(a.terminal.encode(c,!0)),I.html("&nbsp;"),s.html("");else if(0===
d)g.html(""),I.html(a.terminal.encode(c.slice(0,1),!0)),s.html(a.terminal.encode(c.slice(1),!0));else{var e=a.terminal.encode(c.slice(0,d),!0);g.html(e);e=c.slice(d,d+1);I.html(" "===e?"&nbsp;":a.terminal.encode(e,!0));d===c.length-1?s.html(""):s.html(a.terminal.encode(c.slice(d+1),!0))}}function d(c){return"<div>"+a.terminal.encode(c,!0)+"</div>"}function e(c){var b=s;a.each(c,function(c,e){b=a(d(e)).insertAfter(b).addClass("clear")})}function f(c){a.each(c,function(a,c){g.before(d(c))})}var g=I.prev(),
s=I.next();return function(){var t=S?m.replace(/./g,"*"):m,r,q;c.find("div").remove();g.html("");if(t.length>w-u-1||t.match(/\n/)){var l,n=t.match(/\t/g),W=n?3*n.length:0;n&&(t=t.replace(/\t/g,"\x00\x00\x00\x00"));if(t.match(/\n/)){var G=t.split("\n");q=w-u-1;for(r=0;r<G.length-1;++r)G[r]+=" ";G[0].length>q?(l=[G[0].substring(0,q)],l=l.concat(P(G[0].substring(q),w))):l=[G[0]];for(r=1;r<G.length;++r)G[r].length>w?l=l.concat(P(G[r],w)):l.push(G[r])}else l=h(t);n&&(l=a.map(l,function(a){return a.replace(/\x00\x00\x00\x00/g,
"\t")}));q=l[0].length;if(0!==q||1!==l.length)if(p<q)b(l[0],p),e(l.slice(1));else if(p===q)g.before(d(l[0])),b(l[1],0),e(l.slice(2));else if(r=l.length,p<q)b(l[0],p),e(l.slice(1));else if(p===q)g.before(d(l[0])),b(l[1],0),e(l.slice(2));else{var n=l.slice(-1)[0],G=t.length-p,aa=n.length,t=0;if(G<=aa)f(l.slice(0,-1)),b(n,(aa===G?0:aa-G)+W);else if(3===r)g.before("<div>"+a.terminal.encode(l[0],!0)+"</div>"),b(l[1],p-q-1),s.after('<div class="clear">'+a.terminal.encode(l[2],!0)+"</div>");else{t=p;for(r=
0;r<l.length;++r)if(q=l[r].length,t>q)t-=q;else break;q=l[r];W=r;t===q.length&&(t=0,q=l[++W]);b(q,t);f(l.slice(0,W));e(l.slice(W+1))}}}else""===t?(g.html(""),I.html("&nbsp;"),s.html("")):b(t,p)}}(g),R,L=function(){function c(d){u=a("<div>"+a.terminal.strip(d)+"</div>").text().length;b.html(a.terminal.format(a.terminal.encode(d)))}var b=g.find(".prompt");return function(){switch(typeof D){case "string":c(D);break;case "function":D(c)}}}(),E=!0,K=[];a.extend(g,{name:function(a){return a!==A?(F=a,c=
new na(a,J),(a=K.length)&&!K[a-1].enabled()&&c.disable(),K.push(c),g):F},purge:function(){for(var a=K.length;a--;)K[a].purge();K=[];return g},history:function(){return c},set:function(a,c){if(a!==A&&(m=a,c||(p=m.length),v(),"function"===typeof e.onCommandChange))e.onCommandChange(m);return g},insert:function(a,c){m=p===m.length?m+a:0===p?a+m:m.slice(0,p)+a+m.slice(p);c||(p+=a.length);v();if("function"===typeof e.onCommandChange)e.onCommandChange(m);return g},get:function(){return m},commands:function(a){return a?
(e.commands=a,g):a},destroy:function(){a(document.documentElement||window).unbind(".cmd");g.stopTime("blink",b);g.find(".cursor").next().remove().end().prev().remove().end().remove();g.find(".prompt, .clipboard").remove();g.removeClass("cmd").removeData("cmd");return g},prompt:function(a){if(a===A)return D;if("string"===typeof a||"function"===typeof a)D=a;else throw"prompt must be a function or string";L();v();return g},position:function(a){return"number"===typeof a?(p=0>a?0:a>m.length?m.length:a,
v(),g):p},visible:function(){var a=g.visible;return function(){a.apply(g,[]);v();L()}}(),show:function(){var a=g.show;return function(){a.apply(g,[]);v();L()}}(),resize:function(a){if(a)w=a;else{a=g.width();var c=I.innerWidth();w=Math.floor(a/c)}v();return g},enable:function(){H||(I.addClass("inverted"),g.everyTime(500,"blink",b),H=!0);return g},isenabled:function(){return H},disable:function(){H&&(g.stopTime("blink",b),I.removeClass("inverted"),H=!1);return g},mask:function(a){return"boolean"===
typeof a?(S=a,v(),g):S}});g.name(e.name||e.prompt||"");D=e.prompt||"> ";L();e.enabled!==A&&!0!==e.enabled||g.enable();a(document.documentElement||window).bind("keypress.cmd",function(c){var b;if(c.ctrlKey&&99===c.which)return!0;q||"function"!==typeof e.keypress||(b=e.keypress(c));if(b===A||b){if(H){if(-1<a.inArray(c.which,[38,13,0,8])&&123!==c.keyCode&&(38!==c.which||!c.shiftKey))return!1;if(!(c.ctrlKey||c.altKey&&100===c.which)||c.altKey)return q?(B+=String.fromCharCode(c.which),d(),f()):g.insert(String.fromCharCode(c.which)),
!1}}else return b}).bind("keydown.cmd",t);g.data("cmd",g);return g};var oa="aliceblue antiquewhite aqua aquamarine azure beige bisque black blanchedalmond blue blueviolet brown burlywood cadetblue chartreuse chocolate coral cornflowerblue cornsilk crimson cyan darkblue darkcyan darkgoldenrod darkgray darkgreen darkkhaki darkmagenta darkolivegreen darkorange darkorchid darkred darksalmon darkseagreen darkslateblue darkslategray darkturquoise darkviolet deeppink deepskyblue dimgray dodgerblue firebrick floralwhite forestgreen fuchsia gainsboro ghostwhite gold goldenrod gray green greenyellow honeydew hotpink indianred indigo ivory khaki lavender lavenderblush lawngreen lemonchiffon lightblue lightcoral lightcyan lightgoldenrodyellow lightgreen lightgrey lightpink lightsalmon lightseagreen lightskyblue lightslategray lightsteelblue lightyellow lime limegreen linen magenta maroon mediumaquamarine mediumblue mediumorchid mediumpurple mediumseagreen mediumslateblue mediumspringgreen mediumturquoise mediumvioletred midnightblue mintcream mistyrose moccasin navajowhite navy oldlace olive olivedrab orange orangered orchid palegoldenrod palegreen paleturquoise palevioletred papayawhip peachpuff peru pink plum powderblue purple red rosybrown royalblue saddlebrown salmon sandybrown seagreen seashell sienna silver skyblue slateblue slategray snow springgreen steelblue tan teal thistle tomato turquoise violet wheat white whitesmoke yellow yellowgreen".split(" "),
pa=/(\[\[[gbiuso]*;[^;]*;[^\]]*\](?:[^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?)/,ca=/\[\[([gbiuso]*);([^;]*);([^;\]]*);?([^;\]]*);?([^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?/g,U=/\[\[([gbiuso]*;[^;\]]*;[^;\]]*(?:;|[^\]()]*);?[^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?/gi,qa=/^\[\[([gbiuso]*;[^;\]]*;[^;\]]*(?:;|[^\]()]*);?[^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]$/gi,ra=/^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/,sa=/https?:\/\/(?:(?!&[^;]+;)[^\s:"'<>)])+/g,ta=/((([^<>('")[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,})))/g,
da=/('[^']*'|"(\\"|[^"])*"|\/(\\\/|[^\/])*\/|(\\ |[^ ])+|[\w-]+)/g,ea=/(\[\[[gbiuso]*;[^;]*;[^\]]*\])/,fa=/\[\[[gbiuso]*;[^;]*;[^\]]*\]?$/;a.terminal={valid_color:function(e){return e.match(ra)||-1!==a.inArray(e,oa)},escape_regex:function(a){return a.replace(/([\^\$\[\]\(\)\+\*\.\|])/g,"\\$1")},have_formatting:function(a){return a.match(U)},is_formatting:function(a){return a.match(qa)},format_split:function(a){return a.split(pa)},split_equal:function(a,b){for(var f=!1,d=!1,h="",s=[],t=a.replace(U,
function(a,b,d){a=b.match(/;/g).length;return"[["+b+(2==a?";;":3==a?";":"")+d.replace(/\\\]/g,"&#93;").replace(/\n/g,"\\n")+"]"+d+"]"}).split(/\n/g),g=0,r=t.length;g<r;++g)if(""===t[g])s.push("");else for(var x=t[g],w=0,u=0,q=0,B=x.length;q<B;++q){if("["===x[q]&&"["===x[q+1])f=!0;else if(f&&"]"===x[q])d=d?f=!1:!0;else if(f&&d||!f)if("&"===x[q]){var z=x.substring(q).match(/^(&[^;]+;)/);if(!z)throw"Unclosed html entity in line "+(g+1)+" at char "+(q+1);q+=z[1].length-2;q===B-1&&s.push(y+z[1]);continue}else"]"===
x[q]&&"\\"===x[q-1]?--u:++u;if(u===b||q===B-1){var y=x.substring(w,q+1);h&&(y=h+y,y.match("]")&&(h=""));w=q+1;u=0;if(z=y.match(U))z=z[z.length-1],"]"!==z[z.length-1]?(h=z.match(ea)[1],y+="]"):y.match(fa)&&(y=y.replace(fa,""),h=z.match(ea)[1]);s.push(y)}}return s},encode:function(a,b){a=b?a.replace(/&(?![^=]+=)/g,"&amp;"):a.replace(/&(?!#[0-9]+;|[a-zA-Z]+;|[^= "]+=[^=])/g,"&amp;");return a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")},format:function(e,
b){var f=a.extend({},{linksNoReferrer:!1},b||{});if("string"===typeof e){var d=a.terminal.format_split(e);d&&1<d.length&&(e=a.map(d,function(b){return""===b?b:"["===b.substring(0,1)?b.replace(ca,function(b,d,e,f,h,w,u){if(""===u)return"";u=u.replace(/\\]/g,"]");b="";-1!==d.indexOf("b")&&(b+="font-weight:bold;");var q=[];-1!==d.indexOf("u")&&q.push("underline");-1!==d.indexOf("s")&&q.push("line-through");-1!==d.indexOf("o")&&q.push("overline");q.length&&(b+="text-decoration:"+q.join(" ")+";");-1!==
d.indexOf("i")&&(b+="font-style:italic;");a.terminal.valid_color(e)&&(b+="color:"+e+";",-1!==d.indexOf("g")&&(b+="text-shadow:0 0 5px "+e+";"));a.terminal.valid_color(f)&&(b+="background-color:"+f);d=""===w?u:w.replace(/&#93;/g,"]");return'<span style="'+b+'"'+(""!==h?' class="'+h+'"':"")+' data-text="'+d.replace('"',"&quote;")+'">'+u+"</span>"}):"<span>"+b+"</span>"}).join(""));return a.map(e.split(/(<\/?span[^>]*>)/g),function(a){return a.match(/span/)?a:a.replace(sa,function(a){var b=a.match(/\.$/);
a=a.replace(/\.$/,"");return'<a target="_blank" '+(f.linksNoReferer?' rel="noreferrer" ':"")+'href="'+a+'">'+a+"</a>"+(b?".":"")}).replace(ta,'<a href="mailto:$1">$1</a>')}).join("").replace(/<span><br\/?><\/span>/g,"<br/>")}return""},escape_brackets:function(a){return a.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;")},strip:function(a){return a.replace(ca,"$6")},active:function(){return J.front()},from_ntroff:function(a){return a.replace(/((?:_\x08.|.\x08_)+)/g,function(a,f){return"[[u;;]"+a.replace(/_x08|\x08_|_\u0008|\u0008_/g,
"")+"]"}).replace(/((?:.\x08.)+)/g,function(a,f){return"[[b;#fff;]"+a.replace(/(.)(?:\x08|\u0008)(.)/g,function(a,b,f){return f})+"]"})},ansi_colors:{normal:{black:"#000",red:"#A00",green:"#008400",yellow:"#A50",blue:"#00A",magenta:"#A0A",cyan:"#0AA",white:"#AAA"},faited:{black:"#000",red:"#640000",green:"#006100",yellow:"#737300",blue:"#000087",magenta:"#650065",cyan:"#008787",white:"#818181"},bold:{black:"#000",red:"#F55",green:"#44D544",yellow:"#FF5",blue:"#55F",magenta:"#F5F",cyan:"#5FF",white:"#FFF"},
palette:"#000000 #AA0000 #00AA00 #AA5500 #0000AA #AA00AA #00AAAA #AAAAAA #555555 #FF5555 #55FF55 #FFFF55 #5555FF #FF55FF #55FFFF #FFFFFF #000000 #00005F #000087 #0000AF #0000D7 #0000FF #005F00 #005F5F #005F87 #005FAF #005FD7 #005FFF #008700 #00875F #008787 #0087AF #0087D7 #00AF00 #00AF5F #00AF87 #00AFAF #00AFD7 #00AFFF #00D700 #00D75F #00D787 #00D7AF #00D7D7 #00D7FF #00FF00 #00FF5F #00FF87 #00FFAF #00FFD7 #00FFFF #5F0000 #5F005F #5F0087 #5F00AF #5F00D7 #5F00FF #5F5F00 #5F5F5F #5F5F87 #5F5FAF #5F5FD7 #5F5FFF #5F8700 #5F875F #5F8787 #5F87AF #5F87D7 #5F87FF #5FAF00 #5FAF5F #5FAF87 #5FAFAF #5FAFD7 #5FAFFF #5FD700 #5FD75F #5FD787 #5FD7AF #5FD7D7 #5FD7FF #5FFF00 #5FFF5F #5FFF87 #5FFFAF #5FFFD7 #5FFFFF #870000 #87005F #870087 #8700AF #8700D7 #8700FF #875F00 #875F5F #875F87 #875FAF #875FD7 #875FFF #878700 #87875F #878787 #8787AF #8787D7 #8787FF #87AF00 #87AF5F #87AF87 #87AFAF #87AFD7 #87AFFF #87D700 #87D75F #87D787 #87D7AF #87D7D7 #87D7FF #87FF00 #87FF5F #87FF87 #87FFAF #87FFD7 #87FFFF #AF0000 #AF005F #AF0087 #AF00AF #AF00D7 #AF00FF #AF5F00 #AF5F5F #AF5F87 #AF5FAF #AF5FD7 #AF5FFF #AF8700 #AF875F #AF8787 #AF87AF #AF87D7 #AF87FF #AFAF00 #AFAF5F #AFAF87 #AFAFAF #AFAFD7 #AFAFFF #AFD700 #AFD75F #AFD787 #AFD7AF #AFD7D7 #AFD7FF #AFFF00 #AFFF5F #AFFF87 #AFFFAF #AFFFD7 #AFFFFF #D70000 #D7005F #D70087 #D700AF #D700D7 #D700FF #D75F00 #D75F5F #D75F87 #D75FAF #D75FD7 #D75FFF #D78700 #D7875F #D78787 #D787AF #D787D7 #D787FF #D7AF00 #D7AF5F #D7AF87 #D7AFAF #D7AFD7 #D7AFFF #D7D700 #D7D75F #D7D787 #D7D7AF #D7D7D7 #D7D7FF #D7FF00 #D7FF5F #D7FF87 #D7FFAF #D7FFD7 #D7FFFF #FF0000 #FF005F #FF0087 #FF00AF #FF00D7 #FF00FF #FF5F00 #FF5F5F #FF5F87 #FF5FAF #FF5FD7 #FF5FFF #FF8700 #FF875F #FF8787 #FF87AF #FF87D7 #FF87FF #FFAF00 #FFAF5F #FFAF87 #FFAFAF #FFAFD7 #FFAFFF #FFD700 #FFD75F #FFD787 #FFD7AF #FFD7D7 #FFD7FF #FFFF00 #FFFF5F #FFFF87 #FFFFAF #FFFFD7 #FFFFFF #080808 #121212 #1C1C1C #262626 #303030 #3A3A3A #444444 #4E4E4E #585858 #626262 #6C6C6C #767676 #808080 #8A8A8A #949494 #9E9E9E #A8A8A8 #B2B2B2 #BCBCBC #C6C6C6 #D0D0D0 #DADADA #E4E4E4 #EEEEEE".split(" ")},
from_ansi:function(){var e={30:"black",31:"red",32:"green",33:"yellow",34:"blue",35:"magenta",36:"cyan",37:"white",39:"white"},b={40:"black",41:"red",42:"green",43:"yellow",44:"blue",45:"magenta",46:"cyan",47:"white",49:"black"};return function(f){var d=f.split(/(\x1B\[[0-9;]*[A-Za-z])/g);if(1==d.length)return f;f=[];3<d.length&&"[0m"==d.slice(0,3).join("")&&(d=d.slice(3));for(var h=!1,s,t,g,r,x=0;x<d.length;++x)if(r=d[x].match(/^\x1B\[([0-9;]*)([A-Za-z])$/))switch(r[2]){case "m":if(""===r[1])continue;
if("0"!==r[1]){var w=r[1].split(";"),u=void 0,q=g=!1,B=!1,z=[],y="",A="",m=!1,p=!1,D=!1,H=a.terminal.ansi_colors.palette,J=void 0;for(J in w){u=parseInt(w[J],10);switch(u){case 1:z.push("b");B=!0;g=!1;break;case 4:z.push("u");break;case 3:z.push("i");break;case 5:D=!0;break;case 38:m=!0;break;case 48:p=!0;break;case 2:g=!0;B=!1;break;case 7:q=!0;break;default:m&&D&&H[u-1]?y=H[u-1]:e[u]&&(y=e[u]),p&&D&&H[u-1]?A=H[u-1]:b[u]&&(A=b[u])}5!==u&&(D=!1)}q&&(y&&A?(w=A,A=y,y=w):(y="black",A="white"));u=w=void 0;
w=B?u=a.terminal.ansi_colors.bold:g?u=a.terminal.ansi_colors.faited:u=a.terminal.ansi_colors.normal;g=[z.join(""),m?y:w[y],p?A:u[A]]}else g=["",""];h?(f.push("]"),"0"==r[1]?(h=!1,s=t=""):(g[1]=g[1]||s,g[2]=g[2]||t,f.push("[["+g.join(";")+"]"),g[1]&&(s=g[1]),g[2]&&(t=g[2]))):(h=!0,f.push("[["+g.join(";")+"]"),g[1]&&(s=g[1]),g[2]&&(t=g[2]))}else f.push(d[x]);h&&f.push("]");return f.join("")}}(),parseArguments:function(e){return a.map(e.match(da)||[],function(a){return"'"===a[0]&&"'"===a[a.length-1]?
a.replace(/^'|'$/g,""):'"'===a[0]&&'"'===a[a.length-1]?(a=a.replace(/^"|"$/g,"").replace(/\\([" ])/g,"$1"),a.replace(/\\\\|\\t|\\n/g,function(a){return"t"===a[1]?"\t":"n"===a[1]?"\n":"\\"}).replace(/\\x([0-9a-f]+)/gi,function(a,b){return String.fromCharCode(parseInt(b,16))}).replace(/\\0([0-7]+)/g,function(a,b){return String.fromCharCode(parseInt(b,8))})):"/"===a[0]&&"/"==a[a.length-1]?new RegExp(a.replace(/^\/|\/$/g,"")):a.match(/^-?[0-9]+$/)?parseInt(a,10):a.match(/^[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?$/)?
parseFloat(a):a.replace(/\\ /g," ")})},splitArguments:function(e){return a.map(e.match(da)||[],function(a){return"'"===a[0]&&"'"===a[a.length-1]?a.replace(/^'|'$/g,""):'"'===a[0]&&'"'===a[a.length-1]?a.replace(/^"|"$/g,"").replace(/\\([" ])/g,"$1"):"/"===a[0]&&"/"==a[a.length-1]?a:a.replace(/\\ /g," ")})},parseCommand:function(e){return $(e,a.terminal.parseArguments)},splitCommand:function(e){return $(e,a.terminal.splitArguments)},test:function(){function e(a,d){b.echo(d+" &#91;"+(a?"[[b;#44D544;]PASS]":
"[[b;#FF5555;]FAIL]")+"&#93;")}var b=a.terminal.active();b||(b=a("body").terminal(a.noop).css("margin",0),b.outerHeight(),b.height(),a(window).resize(function(){b.css("height",a(window).height()-20)}).resize());b.echo("Testing...");var f='name "foo bar" baz /^asd [x]/ str\\ str 10 1e10',d=a.terminal.splitCommand(f);e("name"===d.name&&"foo bar"===d.args[0]&&"baz"===d.args[1]&&"/^asd [x]/"===d.args[2]&&"str str"===d.args[3]&&"10"===d.args[4]&&"1e10"===d.args[5],"$.terminal.splitCommand");d=a.terminal.parseCommand(f);
e("name"===d.name&&"foo bar"===d.args[0]&&"baz"===d.args[1]&&"regexp"===a.type(d.args[2])&&"^asd [x]"===d.args[2].source&&"str str"===d.args[3]&&10===d.args[4]&&1E10===d.args[5],"$.terminal.parseCommand");e("[[;#640000;#008787]Foo][[biu;#44D544;#F5F]Bar][[;#000;#AAA]Baz]"===a.terminal.from_ansi("\u001b[2;31;46mFoo\u001b[1;3;4;32;45mBar\u001b[0m\u001b[7mBaz"),"$.terminal.from_ansi");f="[[biugs;#fff;#000]Foo][[i;;;foo]Bar][[ous;;]Baz]";b.echo("$.terminal.format");e('<span style="font-weight:bold;text-decoration:underline line-through;font-style:italic;color:#fff;text-shadow:0 0 5px #fff;background-color:#000" data-text="Foo">Foo</span><span style="font-style:italic;" class="foo" data-text="Bar">Bar</span><span style="text-decoration:underline line-through overline;" data-text="Baz">Baz</span>'===
a.terminal.format(f),"\tformatting");e('<a target="_blank" href="http://terminal.jcubic.pl/examples.php">http://terminal.jcubic.pl/examples.php</a> <a target="_blank" href="https://www.google.com/?q=jquery%20terminal">https://www.google.com/?q=jquery%20terminal</a>'===a.terminal.format("http://terminal.jcubic.pl/examples.php https://www.google.com/?q=jquery%20terminal"),"\turls");e('<a href="mailto:foo@bar.com">foo@bar.com</a> <a href="mailto:baz.quux@example.com">baz.quux@example.com</a>'===a.terminal.format("foo@bar.com baz.quux@example.com"),
"\temails");e("-_-Foo-_-Bar-_-Baz-_-"===a.terminal.strip("-_-[[biugs;#fff;#000]Foo]-_-[[i;;;foo]Bar]-_-[[ous;;]Baz]-_-"),"$.terminal.strip");f="[[bui;#fff;]Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla sed dolor nisl, in suscipit justo. Donec a enim et est porttitor semper at vitae augue. Proin at nulla at dui mattis mattis. Nam a volutpat ante. Aliquam consequat dui eu sem convallis ullamcorper. Nulla suscipit, massa vitae suscipit ornare, tellus] est [[b;;#f00]consequat nunc, quis blandit elit odio eu arcu. Nam a urna nec nisl varius sodales. Mauris iaculis tincidunt orci id commodo. Aliquam] non magna quis [[i;;]tortor malesuada aliquam] eget ut lacus. Nam ut vestibulum est. Praesent volutpat tellus in eros dapibus elementum. Nam laoreet risus non nulla mollis ac luctus [[ub;#fff;]felis dapibus. Pellentesque mattis elementum augue non sollicitudin. Nullam lobortis fermentum elit ac mollis. Nam ac varius risus. Cras faucibus euismod nulla, ac auctor diam rutrum sit amet. Nulla vel odio erat], ac mattis enim.";
b.echo("$.terminal.split_equal");for(var d=[10,40,60,400],h=d.length;h--;){for(var s=a.terminal.split_equal(f,d[h]),t=!0,g=0;g<s.length;++g)if(a.terminal.strip(s[g]).length>d[h]){t=!1;break}e(t,"\tsplit "+d[h])}}};a.fn.visible=function(){return this.css("visibility","visible")};a.fn.hidden=function(){return this.css("visibility","hidden")};var ua=0;a.jrpc=function(e,b,f,d,h){b=a.json_stringify({jsonrpc:"2.0",method:b,params:f,id:++ua});return a.ajax({url:e,data:b,success:d,error:h,contentType:"application/json",
dataType:"json",async:!0,cache:!1,type:"POST"})};var N=(O=!"0.7.12".match(/^\{\{/))?" version 0.7.12":" ",ga=new RegExp(" {"+N.length+"}$"),va=[["jQuery Terminal","(c) 2011-2013 jcubic"],["jQuery Terminal Emulator"+(O?" v. 0.7.12":""),"Copyright (c) 2011-2013 Jakub Jankiewicz <http://jcubic.pl>".replace(/ *<.*>/,"")],["jQuery Terminal Emulator"+(O?N:""),"Copyright (c) 2011-2013 Jakub Jankiewicz <http://jcubic.pl>".replace(/^Copyright /,"")],["      _______                 ________                        __",
"     / / _  /_ ____________ _/__  ___/______________  _____  / /"," __ / / // / // / _  / _/ // / / / _  / _/     / /  \\/ / _ \\/ /","/  / / // / // / ___/ // // / / / ___/ // / / / / /\\  / // / /__","\\___/____ \\\\__/____/_/ \\__ / /_/____/_//_/ /_/ /_/  \\/\\__\\_\\___/","         \\/          /____/                                   ".replace(ga," ")+N,"Copyright (c) 2011-2013 Jakub Jankiewicz <http://jcubic.pl>"],["      __ _____                     ________                              __",
"     / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /"," __ / // // // // // _  // _// // / / // _  // _//     // //  \\/ // _ \\/ /","/  / // // // // // ___// / / // / / // ___// / / / / // // /\\  // // / /__","\\___//____ \\\\___//____//_/ _\\_  / /_//____//_/ /_/ /_//_//_/ /_/ \\__\\_\\___/","          \\/              /____/                                          ".replace(ga,"")+N,"Copyright (c) 2011-2013 Jakub Jankiewicz <http://jcubic.pl>"]];a.terminal.defaults={prompt:"> ",
history:!0,exit:!0,clear:!0,enabled:!0,historySize:60,checkArity:!0,displayExceptions:!0,cancelableAjax:!0,processArguments:!0,linksNoReferrer:!1,login:null,outputLimit:-1,tabcompletion:null,historyFilter:null,onInit:a.noop,onClear:a.noop,onBlur:a.noop,onFocus:a.noop,onTerminalChange:a.noop,onExit:a.noop,keypress:a.noop,keydown:a.noop};var X=[],J=new function(e){var b=e?[e]:[],f=0;a.extend(this,{get:function(){return b},rotate:function(){if(1===b.length)return b[0];f===b.length-1?f=0:++f;return b[f]},
length:function(){return b.length},set:function(a){for(var e=b.length;e--;)if(b[e]===a){f=e;return}this.append(a)},front:function(){return b[f]},append:function(a){b.push(a)}})};a.fn.terminal=function(e,b){function f(c){return"function"===typeof k.processArguments?$(c,k.processArguments):k.processArguments?a.terminal.parseCommand(c):a.terminal.splitCommand(c)}function d(n){"string"===typeof n?c.echo(n):n instanceof Array?c.echo(a.map(n,function(c){return a.json_stringify(c)}).join(" ")):"object"===
typeof n?c.echo(a.json_stringify(n)):c.echo(n)}function h(n){var b=function(b,e){c.pause();a.jrpc(n,b,e,function(a){a.error?c.error("&#91;RPC&#93; "+a.error.message):d(a.result);c.resume()},function(a,n,b){"abort"!==n&&c.error("&#91;AJAX&#93; "+n+" - Server reponse is: \n"+a.responseText);c.resume()})};return function(a,c){if(""!==a)if(a=f(a),k.login&&"help"!==a.name){var n=c.token();n?b(a.name,[n].concat(a.args)):c.error("&#91;AUTH&#93; Access denied (no token)")}else b(a.name,a.args)}}function s(n,
b){return function(d,e){if(""!==d){d=f(d);var g=n[d.name],k=a.type(g);if("function"===k)if(b&&g.length!==d.args.length)c.error("&#91;Arity&#93; wrong number of arguments. Function '"+d.name+"' expect "+g.length+" got "+d.args.length);else return g.apply(c,d.args);else if("object"===k||"string"===k){var h=[];if("object"===k){for(var l in g)g.hasOwnProperty(l)&&h.push(l);g=s(g,b)}e.push(g,{prompt:d.name+"> ",name:d.name,completion:"object"===k?function(a,c,n){n(h)}:A})}else e.error("Command '"+d.name+
"' Not Found")}}}function t(n,b){b=b||a.noop;var e=a.type(n),f={};if("string"===e)c.pause(),a.jrpc(n,"system.describe",[],function(e){var g=[];if(e.procs){var G={};a.each(e.procs,function(b,e){g.push(e.name);G[e.name]=function(){var b=Array.prototype.slice.call(arguments);k.checkArity&&e.params&&e.params.length!==b.length?c.error("&#91;Arity&#93; wrong number of arguments.Function '"+e.name+"' expect "+e.params.length+" got "+b.length):(c.pause(),a.jrpc(n,e.name,b,function(a){a.error?c.error("&#91;RPC&#93; "+
a.error.message):d(a.result);c.resume()},function(a,n,b){"abort"!==n&&c.error("&#91;AJAX&#93; "+n+" - Server reponse is: \n"+a.responseText);c.resume()}))}});f.interpreter=s(G,!1);f.completion=function(a,c,n){n(g)}}else f.interpreter=h(n),f.completion=k.completion;c.resume();b(f)},function(){f.completion=k.completion;f.interpreter=h(n);b(f)});else if("object"===e){var g=[],l;for(l in n)g.push(l);f.interpreter=s(n,!0);f.completion=function(a,c,n){n(g)};b(f)}else{if("undefined"===e)n=a.noop;else if("function"!==
e)throw e+" is invalid interpreter value";b({interpreter:n,completion:k.completion})}}function g(a){return"string"===typeof a?a:"string"===typeof a.fileName?a.fileName+": "+a.message:a.message}function r(n,b){if(k.displayExceptions){var d=g(n);c.error("&#91;"+b+"&#93;: "+d);"string"===typeof n.fileName&&(c.pause(),a.get(n.fileName,function(a){c.resume();var b=n.lineNumber-1;(a=a.split("\n")[b])&&c.error("&#91;"+n.lineNumber+"&#93;: "+a)}));n.stack&&c.error(n.stack)}}function x(){var a=v.prop?v.prop("scrollHeight"):
v.attr("scrollHeight");v.scrollTop(a)}function w(a,c){try{if("function"===typeof c)c(function(){});else if("string"!==typeof c)throw a+" must be string or function";}catch(b){return r(b,a.toUpperCase()),!1}return!0}function u(c,b){try{var d=a.extend({raw:!1,finalize:a.noop},b||{});c="function"===a.type(c)?c():c;c="string"===a.type(c)?c:String(c);var e,f;d.raw||(c=a.terminal.encode(c));c=a.terminal.from_ntroff(c);c=a.terminal.from_ansi(c);F.push(1);if(!d.raw&&(c.length>M||c.match(/\n/))){var h=a.terminal.split_equal(c,
M);e=0;for(f=h.length;e<f;++e)""===h[e]||"\r"===h[e]?F.push("&nbsp"):d.raw?F.push(h[e]):F.push(a.terminal.format(h[e],{linksNoReferer:k.linksNoReferer}))}else d.raw||(c=a.terminal.format(c,{linksNoReferer:k.linksNoReferer})),F.push(c);F.push(d.finalize)}catch(l){F=[],alert("Internal Exception(draw_line):"+g(l)+"\n"+l.stack)}}function q(){try{var b;if(0<=k.outputLimit){for(var d=c.rows(),e=0===k.outputLimit?d:k.outputLimit,d=0,f,h=a("<div/>"),l=F.length;l--;)if("function"===typeof F[l])f=F[l],b=a("<div/>");
else if(1===F[l]){b.prependTo(h);try{f(b)}catch(m){r(m,"USER:echo(finalize)")}}else if(b.prepend("<div>"+F[l]+"</div>"),++d===e){if(1!==F[l-1])try{f(b)}catch(q){r(q,"USER:echo(finalize)")}break}h.children().appendTo(K)}else a.each(F,function(c,d){if(1===d)b=a("<div></div>");else if("function"===typeof d){b.appendTo(K);try{d(b)}catch(e){r(e,"USER:echo(finalize)")}}else a("<div/>").html(d).appendTo(b).width("100%")});x();F=[]}catch(p){alert("flush "+g(p)+"\n"+p.stack)}}function B(){k.greetings===A?
c.echo(c.signature):k.greetings&&c.echo(k.greetings)}function z(b){b=a.terminal.escape_brackets(a.terminal.encode(b,!0));var d=l.prompt();l.mask()&&(b=b.replace(/./g,"*"));"function"===typeof d?d(function(a){c.echo(a+b)}):c.echo(d+b)}function y(a,b){try{R=a;var d=C.top();if("exit"===a&&k.exit)1===C.size()?k.login?m():(b||z(a),c.echo("You can't exit from main interpeter")):c.pop("exit");else{b||z(a);var e=E.length-1;if("clear"===a&&k.clear)c.clear();else{var f=d.interpreter(a,c);f!==A&&(e===E.length-
1?(E.pop(),!1!==f&&c.echo(f)):E=!1===f?E.slice(0,e).concat(E.slice(e+1)):E.slice(0,e).concat([f]).concat(E.slice(e+1)),c.resize())}}}catch(g){throw r(g,"USER"),c.resume(),g;}}function S(b,d){var e=null;l.prompt("login: ");k.history&&l.history().disable();l.commands(function(f){try{if(z(f),e){l.mask(!1);c.pause();if("function"!==typeof k.login)throw"Value of login property must be a function";b(e,f,function(b){if(b){var n=k.name,n=(n?n+"_":"")+Q+"_";a.Storage.set(n+"token",b);a.Storage.set(n+"login",
e);l.commands(y);k.history&&l.history().enable();"function"==typeof d&&d()}else c.error("Wrong password try again"),l.prompt("login: "),e=null;c.resume()},c)}else e=f,l.prompt("password: "),l.mask(!0)}catch(g){throw r(g,"LOGIN",c),g;}})}function m(){if("function"===typeof k.onBeforelogout)try{if(!1===k.onBeforelogout(c))return}catch(b){throw r(b,"onBeforelogout"),b;}var d=(k.name?k.name+"_":"")+Q+"_";a.Storage.remove(d+"token");a.Storage.remove(d+"login");S(k.login,H);if("function"===typeof k.onAfterlogout)try{k.onAfterlogout(c)}catch(e){throw r(e,
"onAfterlogout"),e;}}function p(c){var b=(k.name?k.name+"_":"")+Q+"_interpreters",d=a.Storage.get(b),d=d?(new Function("return "+d+";"))():[];-1==a.inArray(c,d)&&(d.push(c),a.Storage.set(b,a.json_stringify(d)))}function D(){var a=C.top(),b=(k.name?k.name+"_":"")+Q+(I.length?"_"+I.join("_"):"");p(b);l.name(b);"function"==typeof a.prompt?l.prompt(function(b){a.prompt(b,c)}):l.prompt(a.prompt);l.set("");if("function"===typeof a.onStart)a.onStart(c)}function H(){D();B();if("function"===typeof k.onInit)try{k.onInit(c)}catch(a){throw r(a,
"OnInit"),a;}}function O(b){var d,e;d=C.top();if("function"===a.type(d.keydown)&&(d=d.keydown(b,c),d!==A))return d;c.oneTime(10,function(){U()});if("function"===a.type(k.keydown)&&(d=k.keydown(b,c),d!==A))return d;if(!c.paused()){9!==b.which&&(L=0);if(68===b.which&&b.ctrlKey)return""===l.get()?1<C.size()||k.login!==A?c.pop(""):(c.resume(),c.echo("")):c.set_command(""),!1;if(k.tabcompletion&&9===b.which){++L;var f=l.get().substring(0,l.position());b=f.split(" ");var g;if(1==b.length)g=b[0];else for(g=
b[b.length-1],e=b.length-1;0<e;e--)if("\\"==b[e-1][b[e-1].length-1])g=b[e-1]+" "+g;else break;C.top().completion(c,g,function(b){if(l.get().substring(0,l.position())===f){var d=new RegExp("^"+a.terminal.escape_regex(g)),n=!1;-1!=f.lastIndexOf(".")&&(d=new RegExp("^"+a.terminal.escape_regex(g.substring(g.lastIndexOf(".")+1))),n=!0);var h=[];for(e=b.length;e--;)d.test(b[e])&&h.push(b[e]);if(1===h.length)c.insert(h[0].replace(d,"")),n&&c.insert("()");else if(1<h.length)if(2<=L)z(f),c.echo(h.sort().join("\t")),
L=0;else{b=!1;n=g.length;a:for(;n<h[0].length;++n){for(e=1;e<h.length;++e)if(h[0].charAt(n)!==h[e].charAt(n))break a;b=!0}b&&c.insert(h[0].slice(0,n).replace(d,""))}}});return!1}if(86===b.which&&b.ctrlKey)c.oneTime(1,function(){x()});else if(9===b.which&&b.ctrlKey){if(1<J.length())return c.focus(!1),!1}else 34===b.which?c.scroll(c.height()):33===b.which?c.scroll(-c.height()):c.attr({scrollTop:c.attr("scrollHeight")})}else if(68===b.which&&b.ctrlKey){if(X.length){for(e=X.length;e--;)if(b=X[e],4!==
b.readyState)try{b.abort()}catch(h){c.error("error in aborting ajax")}X=[];c.resume()}return!1}}var F=[],c=this;if(1<this.length)return this.each(function(){a.fn.terminal.call(a(this),e,a.extend({name:c.selector},b))});if(c.data("terminal"))return c.data("terminal");if(0===c.length)throw'Sorry, but terminal said that "'+c.selector+'" is not valid selector!';var I=[],v,R,L=0,E=[],K,Q=J.length(),M,N,Z,P=[],k=a.extend({},a.terminal.defaults,{name:c.selector},b||{}),T=!k.enabled;a.extend(c,a.omap({clear:function(){K.html("");
l.set("");E=[];try{k.onClear(c)}catch(a){throw r(a,"onClear"),a;}c.attr({scrollTop:0});return c},export_view:function(){return{prompt:c.get_prompt(),command:c.get_command(),position:l.position(),lines:E.slice(0)}},import_view:function(a){c.set_prompt(a.prompt);c.set_command(a.command);l.position(a.position);E=a.lines;c.resize();return c},exec:function(a,b){T?P.push([a,b]):y(a,b);return c},login:S,settings:k,commands:function(){return C.top().interpreter},greetings:function(){B();return c},paused:function(){return T},
pause:function(){l&&(T=!0,c.disable(),l.hidden());return c},resume:function(){if(l){c.enable();var a=P;for(P=[];a.length;){var b=a.shift();c.exec.apply(c,b)}l.visible();x()}return c},cols:function(){return M},rows:function(){var b=a('<div class="terminal"><span>&nbsp;</span></div>').appendTo("body"),d=Math.floor(c.height()/b.height());b.remove();return d},history:function(){return l.history()},next:function(){if(1===J.length())return c;var b=c.offset().top;c.height();c.scrollTop();var d=c,e=a(window).scrollTop(),
f=e+a(window).height(),g=a(d).offset().top;if(g+a(d).height()>=e&&g<=f){J.front().disable();b=J.rotate().enable();d=b.offset().top-50;a("html,body").animate({scrollTop:d},500);try{k.onTerminalChange(b)}catch(h){throw r(h,"onTerminalChange"),h;}return b}c.enable();a("html,body").animate({scrollTop:b-50},500);return c},focus:function(a,b){c.oneTime(1,function(){if(1===J.length())if(!1===a)try{b||!1===k.onBlur(c)||c.disable()}catch(d){throw r(d,"onBlur"),d;}else try{b||!1===k.onFocus(c)||c.enable()}catch(e){throw r(e,
"onFocus"),e;}else if(!1===a)c.next();else{var f=J.front();if(f!=c&&(f.disable(),!b))try{k.onTerminalChange(c)}catch(g){throw r(g,"onTerminalChange"),g;}J.set(c);c.enable()}});return c},enable:function(){M===A&&c.resize();T&&l&&(l.enable(),T=!1);return c},disable:function(){l&&(T=!0,l.disable());return c},enabled:function(){return T},signature:function(){var a=c.cols(),a=15>a?null:35>a?0:55>a?1:64>a?2:75>a?3:4;return null!==a?va[a].join("\n")+"\n":""},version:function(){return"0.7.12"},get_command:function(){return l.get()},
insert:function(a){if("string"===typeof a)return l.insert(a),c;throw"insert function argument is not a string";},set_prompt:function(a){w("prompt",a)&&("function"==typeof a?l.prompt(function(b){a(b,c)}):l.prompt(a),C.top().prompt=a);return c},get_prompt:function(){return C.top().prompt},set_command:function(a){l.set(a);return c},set_mask:function(a){l.mask(a);return c},get_output:function(b){return b?E:a.map(E,function(a){return"function"==typeof a[0]?a[0]():a[0]}).join("\n")},resize:function(b,d){b&&
d&&(c.width(b),c.height(d));b=c.width();d=c.height();var e=ba(c);if(e!==M){M=e;l.resize(M);e=K.empty().detach();a.each(E,function(a,b){u.apply(null,b)});l.before(e);q();if("function"===typeof k.onResize&&(Z!==d||N!==b))k.onResize(c);if(Z!==d||N!==b)Z=d,N=b}return c},flush:function(){q()},echo:function(b,d){try{b=b||"";var e=a.extend({flush:!0,raw:!1,finalize:a.noop},d||{});F=[];u(b,e);e.flush&&q();E.push([b,e]);if(0<=e.outputLimit){var f=0===e.outputLimit?c.rows():e.outputLimit,h=K.find("div div");
h.length>f&&h.slice(0,E.length-f+1).remove()}U()}catch(k){alert("terminal.echo "+g(k)+"\n"+k.stack)}return c},error:function(b,d){return c.echo("[[;#f00;]"+a.terminal.escape_brackets(b).replace(/\\$/,"&#92;")+"]",d)},scroll:function(a){var b;a=Math.round(a);v.prop?(a>v.prop("scrollTop")&&0<a&&v.prop("scrollTop",0),b=v.prop("scrollTop")):(a>v.attr("scrollTop")&&0<a&&v.attr("scrollTop",0),b=v.attr("scrollTop"));v.scrollTop(b+a);return c},logout:k.login?function(){for(;1<C.size();)C.pop();m();return c}:
function(){throw"You don't have login function";},token:k.login?function(){var b=k.name;return a.Storage.get((b?b+"_":"")+Q+"_token")}:a.noop,login_name:k.login?function(){var b=k.name;return a.Storage.get((b?b+"_":"")+Q+"_login")}:a.noop,name:function(){return C.top().name},push:function(b,d){if(d&&(!d.prompt||w("prompt",d.prompt))||!d){d=d||{};d.name=d.name||R;d.prompt=d.prompt||d.name+" ";I.push(d.name);var e=C.top();e&&(e.mask=l.mask());t(b,function(b){C.push(a.extend({},b,d));D()})}return c},
pop:function(b){b!==A&&z(b);I.pop();if(C.top().name===k.name){if(k.login&&(m(),"function"===a.type(k.onExit)))try{k.onExit(c)}catch(d){throw r(d,"onExit"),d;}}else{b=C.pop();D();if("function"===a.type(b.onExit))try{b.onExit(c)}catch(e){throw r(e,"onExit"),e;}c.set_mask(C.top().mask)}return c},level:function(){return C.size()},reset:function(){for(c.clear();1<C.size();)C.pop();H();return c},purge:function(){var b=(k.name?k.name+"_":"")+Q+"_",d=a.Storage.get(b+"interpreters");a.each((new Function("return "+
d+";"))(),function(b,c){a.Storage.remove(c+"_commands")});a.Storage.remove(b+"interpreters");a.Storage.remove(b+"token");a.Storage.remove(b+"login");return c},destroy:function(){l.destroy().remove();K.remove();a(document).unbind(".terminal");a(window).unbind(".terminal");c.unbind("click, mousewheel");c.removeData("terminal").removeClass("terminal");k.width&&c.css("width","");k.height&&c.css("height","");return c}},function(a,b){return function(){try{return b.apply(this,Array.prototype.slice.apply(arguments))}catch(c){throw"exec"!==
a&&r(c,"TERMINAL"),c;}}}));var U=function(){var a=Y(c);return function(){a!==Y(c)&&(c.resize(),a=Y(c))}}();k.width&&c.width(k.width);k.height&&c.height(k.height);v=navigator.userAgent.toLowerCase().match(/(webkit)[ \/]([\w.]+)/)||"body"!=c[0].tagName.toLowerCase()?c:a("html");a(document).bind("ajaxSend.terminal",function(a,b,c){X.push(b)});K=a("<div>").addClass("terminal-output").appendTo(c);c.addClass("terminal");if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)c.click(function(){c.find("textarea").focus()}),
c.find("textarea").focus();if(k.login&&"function"===typeof k.onBeforeLogin)try{k.onBeforeLogin(c)}catch(V){throw r(V,"onBeforeLogin"),V;}"string"!==typeof e||"string"!==typeof k.login&&!k.login||(k.login=function(b){return function(d,f,g,h){c.pause();a.jrpc(e,b,[d,f],function(a){c.resume();!a.error&&a.result?g(a.result):g(null)},function(a,b,d){c.resume();c.error("&#91;AJAX&#92; Response: "+b+"\n"+a.responseText)})}}("boolean"===a.type(k.login)?"login":k.login));J.append(c);if(w("prompt",k.prompt)){var C,
l;t(e,function(b){C=new ma(a.extend({name:k.name,prompt:k.prompt,greetings:k.greetings},b));l=a("<div/>").appendTo(c).cmd({prompt:k.prompt,history:k.history,historyFilter:k.historyFilter,historySize:k.historySize,width:"100%",keydown:O,keypress:k.keypress?function(a){return k.keypress(a,c)}:null,onCommandChange:function(b){if("function"===a.type(k.onCommandChange))try{k.onCommandChange(b,c)}catch(d){throw r(d,"onCommandChange"),d;}x()},commands:y});!0===k.enabled?c.focus(A,!0):c.disable();a(document).bind("click.terminal",
function(b){a(b.target).parents().hasClass("terminal")||!1===k.onBlur(c)||c.disable()});c.click(function(){c.focus()});k.login&&c.token&&!c.token()&&c.login_name&&!c.login_name()?S(k.login,H):H();c.is(":visible")&&(M=ba(c),l.resize(M));c.oneTime(100,function(){a(window).bind("resize.terminal",function(){if(c.is(":visible")){var a=c.width(),b=c.height();Z===b&&N===a||c.resize()}})});"function"===a.type(a.fn.init.prototype.mousewheel)&&c.mousewheel(function(a,b){0<b?c.scroll(-40):c.scroll(40);return!1},
!0)})}c.data("terminal",c);return c}})(jQuery);